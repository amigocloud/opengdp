<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>dwh: MRTSwath/input.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>MRTSwath/input.c</h1>  </div>
</div>
<div class="contents">
<a href="input_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">!C****************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">!File: input.c</span>
<a name="l00005"></a>00005 <span class="comment">  </span>
<a name="l00006"></a>00006 <span class="comment">!Description: Functions reading data from the input data file.</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">!Revision History:</span>
<a name="l00009"></a>00009 <span class="comment"> Revision 1.0 2001/05/08</span>
<a name="l00010"></a>00010 <span class="comment"> Robert Wolfe</span>
<a name="l00011"></a>00011 <span class="comment"> Original Version.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment"> Revision 1.1 2002/05/02</span>
<a name="l00014"></a>00014 <span class="comment"> Robert Wolfe</span>
<a name="l00015"></a>00015 <span class="comment"> Added handling for SDS&#39;s with ranks greater than 2.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment"> Revision 1.5 2002/12/02</span>
<a name="l00018"></a>00018 <span class="comment"> Gail Schmidt</span>
<a name="l00019"></a>00019 <span class="comment"> Added support for INT8 data types.</span>
<a name="l00020"></a>00020 <span class="comment"></span>
<a name="l00021"></a>00021 <span class="comment"> Revision 2.0 2003/10/15</span>
<a name="l00022"></a>00022 <span class="comment"> Gail Schmidt</span>
<a name="l00023"></a>00023 <span class="comment"> GRID types are not supported for MRTSwath</span>
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment"> Revision 2.0 2003/12/13</span>
<a name="l00026"></a>00026 <span class="comment"> Gail Schmidt</span>
<a name="l00027"></a>00027 <span class="comment"> Modified MIN_LS_DIM_SIZE to 250 from 1000, since some of the direct</span>
<a name="l00028"></a>00028 <span class="comment">   broadcast products have fewer than 1000 lines.</span>
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment"> Revision 2.0a 2004/08/21</span>
<a name="l00031"></a>00031 <span class="comment"> Gail Schmidt</span>
<a name="l00032"></a>00032 <span class="comment"> Read the _FillValue and pass it through for resampling.</span>
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">!Team Unique Header:</span>
<a name="l00035"></a>00035 <span class="comment">  This software was developed by the MODIS Land Science Team Support </span>
<a name="l00036"></a>00036 <span class="comment">  Group for the Laboratory for Terrestrial Physics (Code 922) at the </span>
<a name="l00037"></a>00037 <span class="comment">  National Aeronautics and Space Administration, Goddard Space Flight </span>
<a name="l00038"></a>00038 <span class="comment">  Center, under NASA Task 92-012-00.</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment"> ! References and Credits:</span>
<a name="l00041"></a>00041 <span class="comment">  ! MODIS Science Team Member:</span>
<a name="l00042"></a>00042 <span class="comment">      Christopher O. Justice</span>
<a name="l00043"></a>00043 <span class="comment">      MODIS Land Science Team           University of Maryland</span>
<a name="l00044"></a>00044 <span class="comment">      justice@hermes.geog.umd.edu       Dept. of Geography</span>
<a name="l00045"></a>00045 <span class="comment">      phone: 301-405-1600               1113 LeFrak Hall</span>
<a name="l00046"></a>00046 <span class="comment">                                        College Park, MD, 20742</span>
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">  ! Developers:</span>
<a name="l00049"></a>00049 <span class="comment">      Robert E. Wolfe (Code 922)</span>
<a name="l00050"></a>00050 <span class="comment">      MODIS Land Team Support Group     Raytheon ITSS</span>
<a name="l00051"></a>00051 <span class="comment">      robert.e.wolfe.1@gsfc.nasa.gov    4400 Forbes Blvd.</span>
<a name="l00052"></a>00052 <span class="comment">      phone: 301-614-5508               Lanham, MD 20770  </span>
<a name="l00053"></a>00053 <span class="comment">  </span>
<a name="l00054"></a>00054 <span class="comment"> ! Design Notes:</span>
<a name="l00055"></a>00055 <span class="comment">   1. The following public functions handle the input data:</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">        OpenInput - Setup &#39;input&#39; data structure and open file for access.</span>
<a name="l00058"></a>00058 <span class="comment">        CloseInput - Close the input file.</span>
<a name="l00059"></a>00059 <span class="comment">        FreeOutput - Free the &#39;input&#39; data structure memory.</span>
<a name="l00060"></a>00060 <span class="comment">        FindInputDim - Determines the line/sample dimension values.</span>
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">   2. &#39;OpenInput&#39; must be called before any of the other routines.  </span>
<a name="l00063"></a>00063 <span class="comment">   3. &#39;FreeInput&#39; should be used to free the &#39;input&#39; data structure.</span>
<a name="l00064"></a>00064 <span class="comment">   4. The only input file type supported is HDF.</span>
<a name="l00065"></a>00065 <span class="comment"></span>
<a name="l00066"></a>00066 <span class="comment">!END****************************************************************************</span>
<a name="l00067"></a>00067 <span class="comment">*/</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="input_8h.html">input.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="myerror_8h.html">myerror.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="mystring_8h.html">mystring.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;hdf.h&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;mfhdf.h&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;HdfEosDef.h&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="geoloc_8h.html">geoloc.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">/* Constants */</span>
<a name="l00079"></a><a class="code" href="input_8c.html#a84600a3fcb8d12f8d2916116143f33c1">00079</a> <span class="preprocessor">#define FILL_ATTR_NAME &quot;_FillValue&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a><a class="code" href="input_8h.html#a38dd00bee99b1f7ba5b5ed409612a955">00081</a> <a class="code" href="struct_input__t.html">Input_t</a> *<a class="code" href="input_8c.html#a38dd00bee99b1f7ba5b5ed409612a955">OpenInput</a>(<span class="keywordtype">char</span> *file_name, <span class="keywordtype">char</span> *sds_name, <span class="keywordtype">int</span> iband, <span class="keywordtype">int</span> rank,
<a name="l00082"></a>00082                    <span class="keywordtype">int</span> *dim, <span class="keywordtype">char</span> *errstr)
<a name="l00083"></a>00083 <span class="comment">/* </span>
<a name="l00084"></a>00084 <span class="comment">!C******************************************************************************</span>
<a name="l00085"></a>00085 <span class="comment"></span>
<a name="l00086"></a>00086 <span class="comment">!Description: &#39;OpenInput&#39; sets up the &#39;input&#39; data structure, opens the</span>
<a name="l00087"></a>00087 <span class="comment"> input file for read access.</span>
<a name="l00088"></a>00088 <span class="comment"> </span>
<a name="l00089"></a>00089 <span class="comment">!Input Parameters:</span>
<a name="l00090"></a>00090 <span class="comment"> file_name      input file name</span>
<a name="l00091"></a>00091 <span class="comment"> sds_name       name of sds to be read</span>
<a name="l00092"></a>00092 <span class="comment"> iband          band number for application of band offset</span>
<a name="l00093"></a>00093 <span class="comment"> rank           rank of the input SDS</span>
<a name="l00094"></a>00094 <span class="comment"> dim            dimension flags; the line and sample dimensions are </span>
<a name="l00095"></a>00095 <span class="comment">                indicated by a -1 and -2 in this array, respectively;</span>
<a name="l00096"></a>00096 <span class="comment">                the index in the other dimensions are indicated by a value </span>
<a name="l00097"></a>00097 <span class="comment">                of zero or greater</span>
<a name="l00098"></a>00098 <span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">!Output Parameters:</span>
<a name="l00100"></a>00100 <span class="comment"> dim            dimension flags</span>
<a name="l00101"></a>00101 <span class="comment"> errstr         error string if an error occurred</span>
<a name="l00102"></a>00102 <span class="comment"> (returns)      &#39;input&#39; data structure or NULL when an error occurs</span>
<a name="l00103"></a>00103 <span class="comment"></span>
<a name="l00104"></a>00104 <span class="comment">!Team Unique Header:</span>
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment"> ! Design Notes:</span>
<a name="l00107"></a>00107 <span class="comment">   1. When &#39;OpenInput&#39; returns, the file is open for HDF access and the </span>
<a name="l00108"></a>00108 <span class="comment">      SDS is open for access.</span>
<a name="l00109"></a>00109 <span class="comment">   2. For an input space type of &#39;GRID_SPACE&#39;, a band number of -1 should be </span>
<a name="l00110"></a>00110 <span class="comment">      given.</span>
<a name="l00111"></a>00111 <span class="comment">   3. The only input HDF data types supported are CHAR8, INT8, UINT8, INT16,</span>
<a name="l00112"></a>00112 <span class="comment">      UINT16, INT32, and UINT32.</span>
<a name="l00113"></a>00113 <span class="comment">   4. An error status is returned when:</span>
<a name="l00114"></a>00114 <span class="comment">       a. the SDS rank is less than 2 or greater than &#39;MYHDF_MAX_RANK&#39;</span>
<a name="l00115"></a>00115 <span class="comment">       b. the band number is less than -1 or greater than or equal to</span>
<a name="l00116"></a>00116 <span class="comment">          &#39;NBAND_OFFSET&#39;</span>
<a name="l00117"></a>00117 <span class="comment">       c. either none or more than one dimension is given for the line </span>
<a name="l00118"></a>00118 <span class="comment">          or sample dimension</span>
<a name="l00119"></a>00119 <span class="comment">       d. an invalid dimension field is given</span>
<a name="l00120"></a>00120 <span class="comment">       e. duplicating strings is not successful</span>
<a name="l00121"></a>00121 <span class="comment">       f. errors occur when opening the input HDF file</span>
<a name="l00122"></a>00122 <span class="comment">       g. errors occur when reading SDS dimensions or attributes</span>
<a name="l00123"></a>00123 <span class="comment">       h. errors occur when opening the SDS for read access</span>
<a name="l00124"></a>00124 <span class="comment">       i. the given SDS rank or dimensions do not match the input file</span>
<a name="l00125"></a>00125 <span class="comment">       j. for an input space type of SWATH_SPACE, the dimensions of a swath </span>
<a name="l00126"></a>00126 <span class="comment">          are not 1, 2 or 4 times the nominal size of a MODIS swath</span>
<a name="l00127"></a>00127 <span class="comment">       k. for an input space type of SWATH_SPACE, the number of lines is not </span>
<a name="l00128"></a>00128 <span class="comment">          an integral multiple of the size of the scan at the given resolution</span>
<a name="l00129"></a>00129 <span class="comment">       l. memory allocation is not successful</span>
<a name="l00130"></a>00130 <span class="comment">       m. an invalid input data type is not supported.</span>
<a name="l00131"></a>00131 <span class="comment">   5. Error messages are handled with the &#39;LOG_RETURN_ERROR&#39; macro.</span>
<a name="l00132"></a>00132 <span class="comment">   6. &#39;FreeInput&#39; should be called to deallocate memory used by the </span>
<a name="l00133"></a>00133 <span class="comment">      &#39;input&#39; data structures.</span>
<a name="l00134"></a>00134 <span class="comment">   7. &#39;CloseInput&#39; should be called after all of the data is written and </span>
<a name="l00135"></a>00135 <span class="comment">      before the &#39;input&#39; data structure memory is released.</span>
<a name="l00136"></a>00136 <span class="comment"></span>
<a name="l00137"></a>00137 <span class="comment">!END****************************************************************************</span>
<a name="l00138"></a>00138 <span class="comment">*/</span>
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   <a class="code" href="struct_input__t.html">Input_t</a> *<span class="keyword">this</span>;
<a name="l00141"></a>00141   <span class="keywordtype">char</span> *error_string = (<span class="keywordtype">char</span> *)NULL;
<a name="l00142"></a>00142   <span class="keywordtype">int</span> ir, ir1;
<a name="l00143"></a>00143   <span class="keywordtype">char</span> tmperrstr[<a class="code" href="logh_8h.html#ab3b240a86312a1448ece249d329722c3">M_MSG_LEN</a>+1];
<a name="l00144"></a>00144   <span class="keywordtype">double</span> fill[<a class="code" href="myhdf_8h.html#a95617ab8c3b566a346d1707651cfa9c6">MYHDF_MAX_NATTR_VAL</a>];
<a name="l00145"></a>00145   <a class="code" href="struct_myhdf__attr__t.html">Myhdf_attr_t</a> attr;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   <span class="comment">/* Check parameters */</span>
<a name="l00148"></a>00148   
<a name="l00149"></a>00149   <span class="keywordflow">if</span> (rank &lt; 2  ||  rank &gt; <a class="code" href="common_8h.html#abd709c71a880585b391489cea483802e">MYHDF_MAX_RANK</a>) {
<a name="l00150"></a>00150     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: invalid rank&quot;</span>);
<a name="l00151"></a>00151     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153   
<a name="l00154"></a>00154   <span class="keywordflow">if</span> (iband &lt; -1  ||  iband &gt;= <a class="code" href="geo__space_8h.html#acd8982f9860f1cfcd8d2097f102be93c">NBAND_OFFSET</a>) {
<a name="l00155"></a>00155     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: invalid band&quot;</span>);
<a name="l00156"></a>00156     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00157"></a>00157   }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159   <span class="comment">/* Create the Input data structure */</span>
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="keyword">this</span> = (<a class="code" href="struct_input__t.html">Input_t</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code" href="struct_input__t.html">Input_t</a>));
<a name="l00162"></a>00162   <span class="keywordflow">if</span> (<span class="keyword">this</span> == (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL) {
<a name="l00163"></a>00163     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: allocating Input data structure&quot;</span>);
<a name="l00164"></a>00164     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00165"></a>00165   }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="comment">/* Populate the data structure */</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   this-&gt;file_name = <a class="code" href="mystring_8c.html#a05036ff8edd5780dbd5b90025335b807">DupString</a>(file_name);
<a name="l00170"></a>00170   <span class="keywordflow">if</span> (this-&gt;file_name == (<span class="keywordtype">char</span> *)NULL) {
<a name="l00171"></a>00171     free(<span class="keyword">this</span>);
<a name="l00172"></a>00172     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: duplicating file name&quot;</span>);
<a name="l00173"></a>00173     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   this-&gt;sds.name = <a class="code" href="mystring_8c.html#a05036ff8edd5780dbd5b90025335b807">DupString</a>(sds_name);
<a name="l00177"></a>00177   <span class="keywordflow">if</span> (this-&gt;sds.name == (<span class="keywordtype">char</span> *)NULL) {
<a name="l00178"></a>00178     free(this-&gt;file_name);
<a name="l00179"></a>00179     free(<span class="keyword">this</span>);
<a name="l00180"></a>00180     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: duplicating sds name&quot;</span>);
<a name="l00181"></a>00181     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00182"></a>00182   }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">/* Open file for SD access */</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   this-&gt;sds_file_id = SDstart((<span class="keywordtype">char</span> *)file_name, DFACC_RDONLY);
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (this-&gt;sds_file_id == <a class="code" href="myhdf_8h.html#ac624fc6aaddb675864caf680dd86cc2b">HDF_ERROR</a>) {
<a name="l00188"></a>00188     free(this-&gt;sds.name);
<a name="l00189"></a>00189     free(this-&gt;file_name);
<a name="l00190"></a>00190     free(<span class="keyword">this</span>);  
<a name="l00191"></a>00191     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: opening input file&quot;</span>);
<a name="l00192"></a>00192     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00193"></a>00193   }
<a name="l00194"></a>00194   this-&gt;open = <span class="keyword">true</span>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196   <span class="comment">/* Get SDS information and start SDS access */</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="keywordflow">if</span> (!<a class="code" href="myhdf_8c.html#ae65621018d08dbae8e5374cfb2b9110c">GetSDSInfo</a>(this-&gt;sds_file_id, &amp;this-&gt;sds)) {
<a name="l00199"></a>00199     SDend(this-&gt;sds_file_id);
<a name="l00200"></a>00200     free(this-&gt;sds.name);
<a name="l00201"></a>00201     free(this-&gt;file_name);
<a name="l00202"></a>00202     free(<span class="keyword">this</span>);
<a name="l00203"></a>00203     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: getting sds info&quot;</span>);
<a name="l00204"></a>00204     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="comment">/* Get dimensions */</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <span class="keywordflow">for</span> (ir = 0; ir &lt; this-&gt;sds.rank; ir++) {
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (!<a class="code" href="myhdf_8c.html#ae1b43c16aea31e8f62a5efb2b2690f59">GetSDSDimInfo</a>(this-&gt;sds.id, &amp;this-&gt;sds.dim[ir], ir)) {
<a name="l00211"></a>00211       <span class="keywordflow">for</span> (ir1 = 0; ir1 &lt; ir; ir1++) free(this-&gt;sds.dim[ir1].name);
<a name="l00212"></a>00212       SDendaccess(this-&gt;sds.id);
<a name="l00213"></a>00213       SDend(this-&gt;sds_file_id);
<a name="l00214"></a>00214       free(this-&gt;sds.name);
<a name="l00215"></a>00215       free(this-&gt;file_name);
<a name="l00216"></a>00216       free(<span class="keyword">this</span>);
<a name="l00217"></a>00217       strcpy (errstr, <span class="stringliteral">&quot;OpenInput: getting dimension&quot;</span>);
<a name="l00218"></a>00218       <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220   }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   <span class="comment">/* Check the rank and dimensions */</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordflow">if</span> (this-&gt;sds.rank != rank) 
<a name="l00225"></a>00225     error_string = <span class="stringliteral">&quot;expected rank does not match&quot;</span>;
<a name="l00226"></a>00226     
<a name="l00227"></a>00227   <span class="keywordflow">if</span> (error_string == (<span class="keywordtype">char</span> *)NULL)
<a name="l00228"></a>00228   {
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (!<a class="code" href="input_8c.html#af28703dee7ddb499ed1d5ab6a54322b1">FindInputDim</a>(rank, dim, this-&gt;sds.dim, this-&gt;extra_dim, &amp;this-&gt;dim,
<a name="l00230"></a>00230         tmperrstr)) {
<a name="l00231"></a>00231       <span class="keywordflow">for</span> (ir1 = 0; ir1 &lt; ir; ir1++) free(this-&gt;sds.dim[ir1].name);
<a name="l00232"></a>00232       SDendaccess(this-&gt;sds.id);
<a name="l00233"></a>00233       SDend(this-&gt;sds_file_id);
<a name="l00234"></a>00234       free(this-&gt;sds.name);
<a name="l00235"></a>00235       free(this-&gt;file_name);
<a name="l00236"></a>00236       free(<span class="keyword">this</span>);
<a name="l00237"></a>00237       sprintf (errstr, <span class="stringliteral">&quot;%s\nOpenInput: unable to determine input line and &quot;</span>
<a name="l00238"></a>00238         <span class="stringliteral">&quot;sample dimensions&quot;</span>, tmperrstr);
<a name="l00239"></a>00239       <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241   }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="comment">/* Check the line and sample dimensions */</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <span class="keywordflow">if</span> (error_string == (<span class="keywordtype">char</span> *)NULL) {
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     this-&gt;size.l = this-&gt;sds.dim[this-&gt;dim.l].nval;
<a name="l00248"></a>00248     this-&gt;size.s = this-&gt;sds.dim[this-&gt;dim.s].nval;
<a name="l00249"></a>00249     
<a name="l00250"></a>00250     this-&gt;ires = -1;
<a name="l00251"></a>00251     this-&gt;ires = (int)((this-&gt;size.s / (<span class="keywordtype">double</span>)<a class="code" href="resamp_8h.html#a8bd1f6305c93bca110867acae3020c80">NFRAME_1KM_MODIS</a>) + 0.5);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (this-&gt;ires != 1  &amp;&amp; 
<a name="l00254"></a>00254         this-&gt;ires != 2  &amp;&amp;  
<a name="l00255"></a>00255         this-&gt;ires != 4) {
<a name="l00256"></a>00256       <span class="keywordflow">for</span> (ir1 = 0; ir1 &lt; ir; ir1++) free(this-&gt;sds.dim[ir1].name);
<a name="l00257"></a>00257       SDendaccess(this-&gt;sds.id);
<a name="l00258"></a>00258       SDend(this-&gt;sds_file_id);
<a name="l00259"></a>00259       free(this-&gt;sds.name);
<a name="l00260"></a>00260       free(this-&gt;file_name);
<a name="l00261"></a>00261       free(<span class="keyword">this</span>);
<a name="l00262"></a>00262       strcpy (errstr, <span class="stringliteral">&quot;OpenInput: invalid resolution&quot;</span>);
<a name="l00263"></a>00263       <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265   }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="comment">/* Get fill value or use 0.0 as the fill */</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269   <span class="keywordflow">if</span> (error_string == (<span class="keywordtype">char</span> *)NULL) {
<a name="l00270"></a>00270     attr.<a class="code" href="struct_myhdf__attr__t.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="input_8c.html#a84600a3fcb8d12f8d2916116143f33c1">FILL_ATTR_NAME</a>;
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (!<a class="code" href="myhdf_8c.html#ad0a657d4fb1e5b512c1cffe83f3bad26">GetAttrDouble</a>(this-&gt;sds.id, &amp;attr, fill)) {
<a name="l00272"></a>00272       this-&gt;fill_value = (int) 0.0;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274     <span class="keywordflow">else</span> {
<a name="l00275"></a>00275       this-&gt;fill_value = (int) fill[0];
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278   
<a name="l00279"></a>00279   <span class="comment">/* Set up the band offset */</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (iband &gt;= 0)
<a name="l00282"></a>00282     this-&gt;iband = iband;
<a name="l00283"></a>00283   <span class="keywordflow">else</span> {
<a name="l00284"></a>00284     <span class="keywordflow">switch</span> (this-&gt;ires) {
<a name="l00285"></a>00285       <span class="keywordflow">case</span> -1:  this-&gt;iband = <a class="code" href="geo__space_8h.html#a99fb83031ce9923c84392b4e92f956b5af0352907c8a2176ec73586ef03435208">BAND_GEN_NONE</a>;  <span class="keywordflow">break</span>;
<a name="l00286"></a>00286       <span class="keywordflow">case</span>  1:  this-&gt;iband = <a class="code" href="geo__space_8h.html#a99fb83031ce9923c84392b4e92f956b5ad715efcc6e7b64e11f429aaf3e6aeff6">BAND_GEN_1KM</a>;   <span class="keywordflow">break</span>;
<a name="l00287"></a>00287       <span class="keywordflow">case</span>  2:  this-&gt;iband = <a class="code" href="geo__space_8h.html#a99fb83031ce9923c84392b4e92f956b5a0fdea8b863e57c738cf8f476a7578e18">BAND_GEN_500M</a>;  <span class="keywordflow">break</span>;
<a name="l00288"></a>00288       <span class="keywordflow">case</span>  4:  this-&gt;iband = <a class="code" href="geo__space_8h.html#a99fb83031ce9923c84392b4e92f956b5a9313760e96a2a5b873e9c3f92de204a0">BAND_GEN_250M</a>;  <span class="keywordflow">break</span>;
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   <span class="comment">/* Check other dimensions */</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   <span class="keywordflow">for</span> (ir = 0; ir &lt; rank; ir++) {
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (this-&gt;extra_dim[ir] &gt;= this-&gt;sds.dim[ir].nval) {
<a name="l00296"></a>00296       <span class="keywordflow">for</span> (ir1 = 0; ir1 &lt; ir; ir1++) free(this-&gt;sds.dim[ir1].name);
<a name="l00297"></a>00297       SDendaccess(this-&gt;sds.id);
<a name="l00298"></a>00298       SDend(this-&gt;sds_file_id);
<a name="l00299"></a>00299       free(this-&gt;sds.name);
<a name="l00300"></a>00300       free(this-&gt;file_name);
<a name="l00301"></a>00301       free(<span class="keyword">this</span>);
<a name="l00302"></a>00302       strcpy (errstr, <span class="stringliteral">&quot;OpenInput: invalid dimension&quot;</span>);
<a name="l00303"></a>00303       <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="comment">/* Calculate number of scans, and for swath space, check for </span>
<a name="l00308"></a>00308 <span class="comment">     an integral number of scans */</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   this-&gt;scan_size.l = <a class="code" href="resamp_8h.html#a3f89f8e72493f21c4c35557a35a24295">NDET_1KM_MODIS</a>;
<a name="l00311"></a>00311   this-&gt;scan_size.l *= this-&gt;ires;
<a name="l00312"></a>00312   this-&gt;scan_size.s = this-&gt;size.s;
<a name="l00313"></a>00313   this-&gt;nscan = (this-&gt;size.l - 1) / this-&gt;scan_size.l + 1;
<a name="l00314"></a>00314   if ((this-&gt;nscan * this-&gt;scan_size.l) != this-&gt;size.l) {
<a name="l00315"></a>00315     <span class="keywordflow">for</span> (ir1 = 0; ir1 &lt; ir; ir1++) free(this-&gt;sds.dim[ir1].name);
<a name="l00316"></a>00316     SDendaccess(this-&gt;sds.id);
<a name="l00317"></a>00317     SDend(this-&gt;sds_file_id);
<a name="l00318"></a>00318     free(this-&gt;sds.name);
<a name="l00319"></a>00319     free(this-&gt;file_name);
<a name="l00320"></a>00320     free(<span class="keyword">this</span>);
<a name="l00321"></a>00321     strcpy (errstr, <span class="stringliteral">&quot;OpenInput: not an integral number of scans&quot;</span>);
<a name="l00322"></a>00322     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="comment">/* Allocate input buffer */</span>
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="keywordflow">switch</span> (this-&gt;sds.type) {
<a name="l00328"></a>00328     <span class="keywordflow">case</span> DFNT_CHAR8:
<a name="l00329"></a>00329       this-&gt;data_type_size = <span class="keyword">sizeof</span>(char8);
<a name="l00330"></a>00330       this-&gt;buf.val_char8 = (char8 *)calloc(this-&gt;size.s, 
<a name="l00331"></a>00331                                      this-&gt;data_type_size);
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (this-&gt;buf.val_char8 == (char8 *)NULL) 
<a name="l00333"></a>00333         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00334"></a>00334       <span class="keywordflow">break</span>;
<a name="l00335"></a>00335     <span class="keywordflow">case</span> DFNT_UINT8:
<a name="l00336"></a>00336       this-&gt;data_type_size = <span class="keyword">sizeof</span>(uint8);
<a name="l00337"></a>00337       this-&gt;buf.val_uint8 = (uint8 *)calloc(this-&gt;size.s, 
<a name="l00338"></a>00338                                      this-&gt;data_type_size);
<a name="l00339"></a>00339       <span class="keywordflow">if</span> (this-&gt;buf.val_uint8 == (uint8 *)NULL) 
<a name="l00340"></a>00340         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00341"></a>00341       <span class="keywordflow">break</span>;
<a name="l00342"></a>00342     <span class="keywordflow">case</span> DFNT_INT8:
<a name="l00343"></a>00343       this-&gt;data_type_size = <span class="keyword">sizeof</span>(int8);
<a name="l00344"></a>00344       this-&gt;buf.val_int8 = (int8 *)calloc(this-&gt;size.s, 
<a name="l00345"></a>00345                                     this-&gt;data_type_size);
<a name="l00346"></a>00346       <span class="keywordflow">if</span> (this-&gt;buf.val_int8 == (int8 *)NULL) 
<a name="l00347"></a>00347         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00348"></a>00348       <span class="keywordflow">break</span>;
<a name="l00349"></a>00349     <span class="keywordflow">case</span> DFNT_INT16:
<a name="l00350"></a>00350       this-&gt;data_type_size = <span class="keyword">sizeof</span>(int16);
<a name="l00351"></a>00351       this-&gt;buf.val_int16 = (int16 *)calloc(this-&gt;size.s, 
<a name="l00352"></a>00352                                      this-&gt;data_type_size);
<a name="l00353"></a>00353       <span class="keywordflow">if</span> (this-&gt;buf.val_int16 == (int16 *)NULL) 
<a name="l00354"></a>00354         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00355"></a>00355       <span class="keywordflow">break</span>;
<a name="l00356"></a>00356     <span class="keywordflow">case</span> DFNT_UINT16:
<a name="l00357"></a>00357       this-&gt;data_type_size = <span class="keyword">sizeof</span>(uint16);
<a name="l00358"></a>00358       this-&gt;buf.val_uint16 = (uint16 *)calloc(this-&gt;size.s, 
<a name="l00359"></a>00359                                        this-&gt;data_type_size);
<a name="l00360"></a>00360       <span class="keywordflow">if</span> (this-&gt;buf.val_uint16 == (uint16 *)NULL) 
<a name="l00361"></a>00361         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00362"></a>00362       <span class="keywordflow">break</span>;
<a name="l00363"></a>00363     <span class="keywordflow">case</span> DFNT_INT32:
<a name="l00364"></a>00364       this-&gt;data_type_size = <span class="keyword">sizeof</span>(int32);
<a name="l00365"></a>00365       this-&gt;buf.val_int32 = (int32 *)calloc(this-&gt;size.s,
<a name="l00366"></a>00366                                             this-&gt;data_type_size);
<a name="l00367"></a>00367       <span class="keywordflow">if</span> (this-&gt;buf.val_int32 == (int32 *)NULL)
<a name="l00368"></a>00368         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00369"></a>00369       <span class="keywordflow">break</span>;
<a name="l00370"></a>00370     <span class="keywordflow">case</span> DFNT_UINT32:
<a name="l00371"></a>00371       this-&gt;data_type_size = <span class="keyword">sizeof</span>(uint32);
<a name="l00372"></a>00372       this-&gt;buf.val_uint32 = (uint32 *)calloc(this-&gt;size.s,
<a name="l00373"></a>00373                                               this-&gt;data_type_size);
<a name="l00374"></a>00374       <span class="keywordflow">if</span> (this-&gt;buf.val_uint32 == (uint32 *)NULL)
<a name="l00375"></a>00375         error_string = <span class="stringliteral">&quot;allocating input i/o buffer&quot;</span>;
<a name="l00376"></a>00376       <span class="keywordflow">break</span>;
<a name="l00377"></a>00377     <span class="keywordflow">default</span>:
<a name="l00378"></a>00378       error_string = <span class="stringliteral">&quot;unsupported data type&quot;</span>;
<a name="l00379"></a>00379   }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (error_string != (<span class="keywordtype">char</span> *)NULL) {
<a name="l00382"></a>00382     <span class="keywordflow">for</span> (ir = 0; ir &lt; this-&gt;sds.rank; ir++)
<a name="l00383"></a>00383       free(this-&gt;sds.dim[ir].name);
<a name="l00384"></a>00384     SDendaccess(this-&gt;sds.id);
<a name="l00385"></a>00385     SDend(this-&gt;sds_file_id);
<a name="l00386"></a>00386     free(this-&gt;sds.name);
<a name="l00387"></a>00387     free(this-&gt;file_name);
<a name="l00388"></a>00388     free(<span class="keyword">this</span>);
<a name="l00389"></a>00389     sprintf (errstr, <span class="stringliteral">&quot;OpenInput: %s&quot;</span>, error_string);
<a name="l00390"></a>00390     <span class="keywordflow">return</span> (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="input_8c.html#a7df30d3c496215b0a39d53bb3cd2b17f">00397</a> <span class="preprocessor">#define MIN_LS_DIM_SIZE (250)</span>
<a name="l00398"></a>00398 <span class="preprocessor"></span>
<a name="l00399"></a><a class="code" href="input_8h.html#af28703dee7ddb499ed1d5ab6a54322b1">00399</a> <span class="keywordtype">bool</span> <a class="code" href="input_8c.html#af28703dee7ddb499ed1d5ab6a54322b1">FindInputDim</a>(<span class="keywordtype">int</span> rank, <span class="keywordtype">int</span> *param_dim, <a class="code" href="struct_myhdf__dim__t.html">Myhdf_dim_t</a> *sds_dim, 
<a name="l00400"></a>00400                   <span class="keywordtype">int</span> *extra_dim, <a class="code" href="struct_img__coord__int__t.html">Img_coord_int_t</a> *dim, <span class="keywordtype">char</span> *errstr)
<a name="l00401"></a>00401 <span class="comment">/* </span>
<a name="l00402"></a>00402 <span class="comment">!C******************************************************************************</span>
<a name="l00403"></a>00403 <span class="comment"></span>
<a name="l00404"></a>00404 <span class="comment">!Description: &#39;FindInputDim&#39; distinguishes between the line/sample and other </span>
<a name="l00405"></a>00405 <span class="comment">              dimensions from the user parameters and the size of the</span>
<a name="l00406"></a>00406 <span class="comment">              dimensions.</span>
<a name="l00407"></a>00407 <span class="comment"> </span>
<a name="l00408"></a>00408 <span class="comment">!Input Parameters:</span>
<a name="l00409"></a>00409 <span class="comment"> rank           rank of the input SDS</span>
<a name="l00410"></a>00410 <span class="comment"> param_dim      dimension flags from the user parameters; the line and </span>
<a name="l00411"></a>00411 <span class="comment">                sample dimensions are </span>
<a name="l00412"></a>00412 <span class="comment">                indicated by a -1 and -2 in this array, respectively;</span>
<a name="l00413"></a>00413 <span class="comment">                the index in the other dimensions are indicated by a value </span>
<a name="l00414"></a>00414 <span class="comment">                of zero or greater</span>
<a name="l00415"></a>00415 <span class="comment"> file_dim       actual SDS dimensions</span>
<a name="l00416"></a>00416 <span class="comment"></span>
<a name="l00417"></a>00417 <span class="comment">!Output Parameters:</span>
<a name="l00418"></a>00418 <span class="comment"> param_dim      updated dimensions</span>
<a name="l00419"></a>00419 <span class="comment"> extra_dim      extra SDS dimensions; other than line and sample</span>
<a name="l00420"></a>00420 <span class="comment"> dim            SDS line and sample dimension locations</span>
<a name="l00421"></a>00421 <span class="comment"> errstr         error string</span>
<a name="l00422"></a>00422 <span class="comment"> (returns)      status:</span>
<a name="l00423"></a>00423 <span class="comment">                  &#39;true&#39; = okay</span>
<a name="l00424"></a>00424 <span class="comment">                  &#39;false&#39; = error return</span>
<a name="l00425"></a>00425 <span class="comment"></span>
<a name="l00426"></a>00426 <span class="comment">!Team Unique Header:</span>
<a name="l00427"></a>00427 <span class="comment"></span>
<a name="l00428"></a>00428 <span class="comment"> ! Design Notes:</span>
<a name="l00429"></a>00429 <span class="comment">   1. An error status is returned when:</span>
<a name="l00430"></a>00430 <span class="comment">       a. the dimensions from the user parameters are not valid</span>
<a name="l00431"></a>00431 <span class="comment">       b. there are either too many large (not line/sample) or small</span>
<a name="l00432"></a>00432 <span class="comment">          (line/sample) dimensions.</span>
<a name="l00433"></a>00433 <span class="comment">   2. Error messages are returned as part of the function call. This</span>
<a name="l00434"></a>00434 <span class="comment">      allows the calling routine (OpenInput) to print those error</span>
<a name="l00435"></a>00435 <span class="comment">      messages or ignore them.</span>
<a name="l00436"></a>00436 <span class="comment"></span>
<a name="l00437"></a>00437 <span class="comment">!END****************************************************************************</span>
<a name="l00438"></a>00438 <span class="comment">*/</span>
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440   <span class="keywordtype">int</span> ir, ils, iextra;
<a name="l00441"></a>00441   <span class="keywordtype">int</span> temp_dim[<a class="code" href="common_8h.html#abd709c71a880585b391489cea483802e">MYHDF_MAX_RANK</a>];
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="comment">/* Set up the default values to be returned */</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   <span class="keywordflow">for</span> (ir = 0; ir &lt; rank; ir++) extra_dim[ir] = 0;
<a name="l00446"></a>00446   dim-&gt;<a class="code" href="struct_img__coord__int__t.html#a89606eca6b563ec68d2da2e84657736f">l</a> = dim-&gt;<a class="code" href="struct_img__coord__int__t.html#a339d22b3e442946380f98ed19e320db2">s</a> = -1;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <span class="comment">/* Check to make sure the line/sample dimensions from the user parameters </span>
<a name="l00449"></a>00449 <span class="comment">     are the first two dimesions */</span>
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="keywordflow">if</span> (param_dim[0] &gt;= 0  ||  
<a name="l00452"></a>00452       param_dim[1] &gt;= 0  ||
<a name="l00453"></a>00453       (param_dim[0] * param_dim[1]) != 2) {
<a name="l00454"></a>00454     strcpy (errstr, <span class="stringliteral">&quot;FindInputDim: invalid line/sample dimensions&quot;</span>);
<a name="l00455"></a>00455     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00456"></a>00456   }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458   <span class="comment">/* Check to make sure that the remaining dimensions from the user parameters</span>
<a name="l00459"></a>00459 <span class="comment">     are valid */</span>
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   <span class="keywordflow">for</span> (ir = 2; ir &lt; rank; ir++) {
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (param_dim[ir] &lt; 0) {
<a name="l00463"></a>00463       strcpy (errstr, <span class="stringliteral">&quot;FindInputDim: invalid remaining dimesions&quot;</span>);
<a name="l00464"></a>00464       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466   }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="comment">/* Figure out which are the line/sample dimensions and which are the</span>
<a name="l00469"></a>00469 <span class="comment">     extra dimensions.  The line and sample dimensions are expected to be</span>
<a name="l00470"></a>00470 <span class="comment">     greater than MIN_LS_DIM_SIZE.  If too many dimensions are &quot;line/sample&quot;</span>
<a name="l00471"></a>00471 <span class="comment">     dimensions, then it is an error.  If not enough dimensions are</span>
<a name="l00472"></a>00472 <span class="comment">     available for &quot;line/sample&quot; dimensions, then it is also an error. */</span>
<a name="l00473"></a>00473 
<a name="l00474"></a>00474   ils = 0;
<a name="l00475"></a>00475   iextra = 2;
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   <span class="keywordflow">for</span> (ir = 0; ir &lt; rank; ir++) {
<a name="l00478"></a>00478     <span class="keywordflow">if</span> (sds_dim[ir].nval &gt; <a class="code" href="input_8c.html#a7df30d3c496215b0a39d53bb3cd2b17f">MIN_LS_DIM_SIZE</a>) {
<a name="l00479"></a>00479       <span class="keywordflow">if</span> (ils &gt; 1) {
<a name="l00480"></a>00480         sprintf (errstr, <span class="stringliteral">&quot;FindInputDim: too many large dimensions. Only &quot;</span>
<a name="l00481"></a>00481           <span class="stringliteral">&quot;the line and sample dimensions can be larger than %d.&quot;</span>,
<a name="l00482"></a>00482           <a class="code" href="input_8c.html#a7df30d3c496215b0a39d53bb3cd2b17f">MIN_LS_DIM_SIZE</a>);
<a name="l00483"></a>00483         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00484"></a>00484       }
<a name="l00485"></a>00485       temp_dim[ir] = param_dim[ils];
<a name="l00486"></a>00486       extra_dim[ir] = 0;
<a name="l00487"></a>00487       <span class="keywordflow">if</span> (temp_dim[ir] == -1) dim-&gt;<a class="code" href="struct_img__coord__int__t.html#a89606eca6b563ec68d2da2e84657736f">l</a> = ir;
<a name="l00488"></a>00488       <span class="keywordflow">else</span> dim-&gt;<a class="code" href="struct_img__coord__int__t.html#a339d22b3e442946380f98ed19e320db2">s</a> = ir;
<a name="l00489"></a>00489       ils++;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     } <span class="keywordflow">else</span> {
<a name="l00492"></a>00492       <span class="keywordflow">if</span> (iextra &gt;= <a class="code" href="common_8h.html#abd709c71a880585b391489cea483802e">MYHDF_MAX_RANK</a>) {
<a name="l00493"></a>00493         sprintf (errstr, <span class="stringliteral">&quot;FindInputDim: too many small dimensions. The &quot;</span>
<a name="l00494"></a>00494           <span class="stringliteral">&quot;line and sample dimensions need to be larger than %d.&quot;</span>,
<a name="l00495"></a>00495           <a class="code" href="input_8c.html#a7df30d3c496215b0a39d53bb3cd2b17f">MIN_LS_DIM_SIZE</a>);
<a name="l00496"></a>00496         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00497"></a>00497       }
<a name="l00498"></a>00498       temp_dim[ir] = param_dim[iextra];
<a name="l00499"></a>00499       extra_dim[ir] = param_dim[iextra];
<a name="l00500"></a>00500       iextra++;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="comment">/* Update the user parameters */</span>
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <span class="keywordflow">for</span> (ir = 0; ir &lt; rank; ir++)
<a name="l00507"></a>00507     param_dim[ir] = temp_dim[ir];
<a name="l00508"></a>00508   
<a name="l00509"></a>00509   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="input_8h.html#abd9d6a1cb216f25f1facc9becb274f43">00513</a> <span class="keywordtype">bool</span> <a class="code" href="input_8c.html#abd9d6a1cb216f25f1facc9becb274f43">CloseInput</a>(<a class="code" href="struct_input__t.html">Input_t</a> *<span class="keyword">this</span>)
<a name="l00514"></a>00514 <span class="comment">/* </span>
<a name="l00515"></a>00515 <span class="comment">!C******************************************************************************</span>
<a name="l00516"></a>00516 <span class="comment"></span>
<a name="l00517"></a>00517 <span class="comment">!Description: &#39;CloseInput&#39; ends SDS access and closes the input file.</span>
<a name="l00518"></a>00518 <span class="comment"> </span>
<a name="l00519"></a>00519 <span class="comment">!Input Parameters:</span>
<a name="l00520"></a>00520 <span class="comment"> this           &#39;input&#39; data structure; the following fields are input:</span>
<a name="l00521"></a>00521 <span class="comment">                   open, sds.id, sds_file_id</span>
<a name="l00522"></a>00522 <span class="comment"></span>
<a name="l00523"></a>00523 <span class="comment">!Output Parameters:</span>
<a name="l00524"></a>00524 <span class="comment"> this           &#39;input&#39; data structure; the following fields are modified:</span>
<a name="l00525"></a>00525 <span class="comment">                   open</span>
<a name="l00526"></a>00526 <span class="comment"> (returns)      status:</span>
<a name="l00527"></a>00527 <span class="comment">                  &#39;true&#39; = okay</span>
<a name="l00528"></a>00528 <span class="comment">                  &#39;false&#39; = error return</span>
<a name="l00529"></a>00529 <span class="comment"></span>
<a name="l00530"></a>00530 <span class="comment">!Team Unique Header:</span>
<a name="l00531"></a>00531 <span class="comment"></span>
<a name="l00532"></a>00532 <span class="comment"> ! Design Notes:</span>
<a name="l00533"></a>00533 <span class="comment">   1. An error status is returned when:</span>
<a name="l00534"></a>00534 <span class="comment">       a. the file is not open for access</span>
<a name="l00535"></a>00535 <span class="comment">       b. an error occurs when closing access to the SDS.</span>
<a name="l00536"></a>00536 <span class="comment">   2. Error messages are handled with the &#39;LOG_RETURN_ERROR&#39; macro.</span>
<a name="l00537"></a>00537 <span class="comment">   3. &#39;OpenInput&#39; must be called before this routine is called.</span>
<a name="l00538"></a>00538 <span class="comment">   4. &#39;FreeInput&#39; should be called to deallocate memory used by the </span>
<a name="l00539"></a>00539 <span class="comment">      &#39;input&#39; data structure.</span>
<a name="l00540"></a>00540 <span class="comment"></span>
<a name="l00541"></a>00541 <span class="comment">!END****************************************************************************</span>
<a name="l00542"></a>00542 <span class="comment">*/</span>
<a name="l00543"></a>00543 {
<a name="l00544"></a>00544 
<a name="l00545"></a>00545  <span class="keywordflow">if</span> (!this-&gt;open)
<a name="l00546"></a>00546     <a class="code" href="myerror_8h.html#a62cf267f4ddf3123ddbe9e88381c7d91">LOG_RETURN_ERROR</a>(<span class="stringliteral">&quot;file not open&quot;</span>, <span class="stringliteral">&quot;CloseInput&quot;</span>, <span class="keyword">false</span>);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <span class="keywordflow">if</span> (SDendaccess(this-&gt;sds.id) == <a class="code" href="myhdf_8h.html#ac624fc6aaddb675864caf680dd86cc2b">HDF_ERROR</a>) 
<a name="l00549"></a>00549     <a class="code" href="myerror_8h.html#a62cf267f4ddf3123ddbe9e88381c7d91">LOG_RETURN_ERROR</a>(<span class="stringliteral">&quot;ending sds access&quot;</span>, <span class="stringliteral">&quot;CloseInput&quot;</span>, <span class="keyword">false</span>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551   SDend(this-&gt;sds_file_id);
<a name="l00552"></a>00552   this-&gt;open = <span class="keyword">false</span>;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 
<a name="l00558"></a><a class="code" href="input_8h.html#a480fc29970bc1883f08539adcaa8a6c5">00558</a> <span class="keywordtype">bool</span> <a class="code" href="input_8c.html#a480fc29970bc1883f08539adcaa8a6c5">FreeInput</a>(<a class="code" href="struct_input__t.html">Input_t</a> *<span class="keyword">this</span>)
<a name="l00559"></a>00559 <span class="comment">/* </span>
<a name="l00560"></a>00560 <span class="comment">!C******************************************************************************</span>
<a name="l00561"></a>00561 <span class="comment"></span>
<a name="l00562"></a>00562 <span class="comment">!Description: &#39;FreeInput&#39; frees the &#39;input&#39; data structure memory.</span>
<a name="l00563"></a>00563 <span class="comment"> </span>
<a name="l00564"></a>00564 <span class="comment">!Input Parameters:</span>
<a name="l00565"></a>00565 <span class="comment"> this           &#39;input&#39; data structure; the following fields are input:</span>
<a name="l00566"></a>00566 <span class="comment">                   sds.rank, sds.dim[*].name, sds.name, file_name</span>
<a name="l00567"></a>00567 <span class="comment"></span>
<a name="l00568"></a>00568 <span class="comment">!Output Parameters:</span>
<a name="l00569"></a>00569 <span class="comment"> (returns)      status:</span>
<a name="l00570"></a>00570 <span class="comment">                  &#39;true&#39; = okay (always returned)</span>
<a name="l00571"></a>00571 <span class="comment"></span>
<a name="l00572"></a>00572 <span class="comment">!Team Unique Header:</span>
<a name="l00573"></a>00573 <span class="comment"></span>
<a name="l00574"></a>00574 <span class="comment"> ! Design Notes:</span>
<a name="l00575"></a>00575 <span class="comment">   1. &#39;OpenInput&#39; and &#39;CloseInput&#39; must be called before this routine is called.</span>
<a name="l00576"></a>00576 <span class="comment">   2. An error status is never returned.</span>
<a name="l00577"></a>00577 <span class="comment"></span>
<a name="l00578"></a>00578 <span class="comment">!END****************************************************************************</span>
<a name="l00579"></a>00579 <span class="comment">*/</span>
<a name="l00580"></a>00580 {
<a name="l00581"></a>00581   <span class="keywordtype">int</span> ir;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="keywordflow">if</span> (<span class="keyword">this</span> != (<a class="code" href="struct_input__t.html">Input_t</a> *)NULL) {
<a name="l00584"></a>00584     <span class="keywordflow">for</span> (ir = 0; ir &lt; this-&gt;sds.rank; ir++) {
<a name="l00585"></a>00585       <span class="keywordflow">if</span> (this-&gt;sds.dim[ir].name != (<span class="keywordtype">char</span> *)NULL) 
<a name="l00586"></a>00586         free(this-&gt;sds.dim[ir].name);
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588     <span class="keywordflow">if</span> (this-&gt;sds.name != (<span class="keywordtype">char</span> *)NULL) free(this-&gt;sds.name);
<a name="l00589"></a>00589     <span class="keywordflow">if</span> (this-&gt;file_name != (<span class="keywordtype">char</span> *)NULL) free(this-&gt;file_name);
<a name="l00590"></a>00590     free(<span class="keyword">this</span>);
<a name="l00591"></a>00591   }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Sun Jun 5 2011 12:05:27 for dwh by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
